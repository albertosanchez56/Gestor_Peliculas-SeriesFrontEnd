<main *ngIf="movie as mv; else loadingTpl">
  <!-- HERO con imagen de fondo de alta calidad + degradado -->
  <section class="backdrop-hero">
    <img
      class="backdrop-img"
      [src]="backdropSrc(movie)"
      [srcset]="backdropSrcset(movie)"
      sizes="100vw"
      [alt]="'Fondo de ' + (movie?.title || '')" />

    <div class="backdrop-fade"></div>

    <!-- Contenido sobre el hero: póster + tráiler -->
    <div class="hero-content">
      <div class="hero-poster">
        <img
          [src]="mv.posterUrl || 'assets/imagenes/placeholder-poster.png'"
          [alt]="'Póster de ' + mv.title" />
        <button class="favorite-button" (click)="onToggleFavorite()">+</button>
      </div>

      <div class="hero-trailer" *ngIf="trailerEmbed; else noTrailerTpl">
        <div class="video-frame">
          <iframe
            [src]="trailerEmbed"
            title="Trailer"
            frameborder="0"
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
            allowfullscreen>
          </iframe>
        </div>
      </div>
      <ng-template #noTrailerTpl>
        <div class="hero-trailer no-trailer">
          <p>No hay tráiler disponible.</p>
        </div>
      </ng-template>
    </div>
  </section>

  <!-- Bloque de datos -->
  <div class="movie-details-container">
    <header class="movie-header">
      <h1 class="movie-title">{{ mv.title }}</h1>
      <span class="movie-rating">{{ ratingText }}</span>
    </header>

    <div class="movie-info-block">
      <p *ngIf="mv.genres?.length"><strong>Género:</strong> {{ genreList }}</p>
      <hr *ngIf="mv.genres?.length">

      <p><strong>Sinopsis:</strong> {{ mv.description || 'No disponible.' }}</p>
      <hr>

      <p *ngIf="mv?.director?.name as dName">
        <strong>Director:</strong> {{ dName }}
      </p>
      <hr>
    </div>

    <!-- Reparto -->
    <section *ngIf="cast.length" class="cast-section">
      <h2 class="cast-title">Reparto principal</h2>

      <div class="cast-grid">
        <div class="cast-card" *ngFor="let c of visibleCast">
          <div class="cast-thumb">
            <img
              [src]="c.profileUrl || 'assets/imagenes/placeholder-profile.png'"
              [alt]="c.personName" />
          </div>
          <div class="cast-meta">
            <div class="cast-name">{{ c.personName }}</div>
            <div class="cast-role" *ngIf="c.characterName">{{ c.characterName }}</div>
          </div>
        </div>
      </div>

      <div class="cast-toggle">
        <button class="toggle-btn" (click)="toggleCast()">
          {{ showAllCast ? 'Ver menos' : 'Ver todo el reparto' }}
        </button>
      </div>
    </section>

    <hr>

    <section class="user-reviews">
      <h2>Opiniones de Usuarios</h2>
      <p>Próximamente…</p>
    </section>
  </div>
</main>

<ng-template #loadingTpl>
  <div class="movie-details-container">Cargando…</div>
</ng-template>
